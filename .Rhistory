Reads_thresh = 50
Markerfile = 'positions.csv'
Quality_filter = TRUE
Quality_thresh = 30
Base_majority = .95
Pileupfile = 'out.pu'

require(mice)
header_names = c("chr", "name", "hg", "pos", "mut", "anc", "der")
marker_table = cc(read.table(Markerfile, col.names=header_names, fill=TRUE, na.strings=""))
pileup_table = read.table(Pileupfile, col.names=c('chr', 'pos', 'refbase', 'reads', 'align', 'quality'), fill=TRUE, na.strings='')
pileup_table = pileup_table[(pileup_table$chr %in% unique(marker_table$chr)) & pileup_table$reads > Reads_thresh, ]
marker_pileup = merge(marker_table, pileup_table)

getbase = function(mydat)
{
    myreads = strsplit(mydat$reads, '')
    myquality = strtoi(charToRaw(mydat$quality), 16L) - 33
    if(Quality_filter)
    {
        myreads = myreads[myquality > Quality_thresh]
    }
    reads_tab = table(myreads)
}
